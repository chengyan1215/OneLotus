function fdtp(n){var t=$(n).attr("urlid");t||($(".mall_pcp").each(function(n,t){$(t).attr("src")&&($(t).attr("urlid",urlData.length),urlData.push($(t).attr("src")))}),myPhotoBrowserCaptions=$.photoBrowser({photos:urlData,theme:"dark"}));myPhotoBrowserCaptions.open($(n).attr("urlid")*1)}function ylwj(n){n&&(window.location=n)}var pmodel=avalon.define({$id:"APP_ADD",nowuser:ComFunJS.getnowuser(),PathCode:"Loading",FormCode:ComFunJS.getQueryString("FormCode"),DataID:ComFunJS.getQueryString("ID",""),PIID:ComFunJS.getQueryString("PIID"),PDID:ComFunJS.getQueryString("PDID"),ExtData:[],PIMODEL:{},PDMODEL:{},TASKDATA:[],USERDATA:[],CSUser:"",CSQKData:[],iscansp:!1,isedit:"N",isHasDataQX:"N",isPC:!0,isDraft:!1,lctype:ComFunJS.getQueryString("LCTYPE","-1"),spReason:"同意",pmtitle:"表单",rdm:Math.random(),render:function(){if(pmodel.isPC||$("table").hide(),typeof tempmodel!="undefined"&&tempmodel){if(pmodel.DataID?tempmodel.inittemp(pmodel.DataID):tempmodel.inittemp(),pmodel.isPC&&parent.layer){var n=parent.layer.getFrameIndex(window.name);parent.layer.title(tempmodel.name,n)}else pmodel.pmtitle=tempmodel.name,document.title=tempmodel.name,$("table").show();avalon.templateCache=null;pmodel.getwfdata(function(){pmodel.lctype==0&&pmodel.getSHUser();$.getJSON("/API/VIEWAPI.ashx?ACTION=XTGL_GETEXTDATA",{P1:pmodel.FormCode,P2:pmodel.DataID,PDID:pmodel.PDID},function(n){n.ErrorMsg==""&&(pmodel.DataID||$(n.Result).each(function(n,t){t.ExtendDataValue=t.DefaultValue}),pmodel.ExtData=n.Result,pmodel.ExtData.size()>0&&($(".extdiv").length>1&&$(".extdiv").each(function(){$(this).width()==0&&$(this).remove()}),$(".extdiv").append($("#extdiv"))),setTimeout("ComFunJS.initForm()",500))})});pmodel.isPC&&pmodel.GetDraft()}},getwfdata:function(n){$.getJSON("/API/VIEWAPI.ashx?ACTION=LCSP_GETWFDATA",{P1:pmodel.PIID,DataID:pmodel.DataID,ModelCode:pmodel.FormCode,P2:pmodel.PDID},function(t){if(t.ErrorMsg=="")return t.Result5&&(pmodel.PDMODEL=t.Result5,pmodel.CSUser=pmodel.PDMODEL.ChaoSongUser),t.Result&&(pmodel.PIMODEL=t.Result,pmodel.CSUser=pmodel.PIMODEL.ChaoSongUser),t.Result1&&(pmodel.TASKDATA=t.Result1),t.Result2&&(pmodel.iscansp=$.parseJSON(t.Result2).ISCANSP=="Y"),t.Result3&&(pmodel.lctype=t.Result3,(pmodel.lctype==0||pmodel.lctype==1)&&$(".btnSucc").html('<i class="fa fa-plus"><\/i>送审')),t.Result4&&(pmodel.isedit=t.Result4,pmodel.isedit=="Y"&&(pmodel.isHasDataQX="Y")),t.Result6&&(pmodel.CSQKData=t.Result6),pmodel.LoadWFData(),n.call(this)})},getSHUser:function(){$.getJSON("/API/VIEWAPI.ashx?ACTION=LCSP_GETSPUSERLIST",{P1:pmodel.FormCode,PDID:pmodel.PDID,PIID:pmodel.PIID},function(n){n.ErrorMsg==""&&(pmodel.USERDATA=n.Result)})},SaveData:function(n,t,i){pmodel.isPC||$("table").hide();var r="";if(r=pmodel.CheckData(),r){top.ComFunJS.winwarning(r);pmodel.isPC||$("table").show();return}if(pmodel.lctype=="0"&&!$("#conshr").val()){top.ComFunJS.winwarning("请选择审核人");$("table").show();return}pmodel.isPC&&$(n).attr("disabled",!0).find(".fa").show();tempmodel.SaveData(function(t){$.trim(t.ErrorMsg)==""?(pmodel.SaveExtData(t.Result.ID),pmodel.DraftData.ID!="0"&&pmodel.DelDraft(),$.getJSON("/API/VIEWAPI.ashx?ACTION=LCSP_STARTWF",{P1:pmodel.FormCode,P2:$("#conshr").val(),PDID:pmodel.PDID,DATAID:t.Result.ID,LCTYPE:pmodel.lctype,csr:pmodel.CSUser},function(n){if($.trim(n.ErrorMsg)=="")if(top.ComFunJS.winsuccess("操作成功"),tempmodel&&$.isFunction(tempmodel.Complate))setTimeout("tempmodel.Complate();",1e3);else if(i=="addlxr"){top.ComFunJS.winviewform("/ViewV5/AppPage/APP_ADD_WF.html?FormCode=CRM_KHLXR&khid="+t.Result.ID,"客户联系人","1000");var r=top.layer.getFrameIndex(window.name);top.layer.close(r)}else pmodel.refiframe()}),pmodel.SaveDraft(t.Result.ID)):(pmodel.isPC&&$(n).attr("disabled",!1).find(".fa").hide(),pmodel.isPC||$("table").show())},n)},SaveExtData:function(n){pmodel.ExtData.size()>0&&$.post("/API/VIEWAPI.ashx?ACTION=XTGL_UPDATEEXTDATA",{P1:pmodel.FormCode,P2:n,ExtData:JSON.stringify(pmodel.ExtData.$model)},function(){})},DraftData:{ID:"0",FormCode:"",FormID:"",JsonData:"",ExtData:"",DataID:""},DraftList:[],SaveDraft:function(n){tempmodel&&(pmodel.DraftData.FormCode=pmodel.FormCode,pmodel.DraftData.JsonData=typeof tempmodel.GetDraftData=="function"?JSON.stringify(tempmodel.GetDraftData()):JSON.stringify(tempmodel.modelData.$model),pmodel.DraftData.ExtData=JSON.stringify(pmodel.ExtData.$model),pmodel.PDMODEL&&(pmodel.DraftData.FormID=pmodel.PDMODEL.ID),n&&(pmodel.DraftData.DataID=n),$.post("/API/VIEWAPI.ashx?ACTION=XTGL_SAVEDRAFT",{P1:JSON.stringify(pmodel.DraftData.$model)},function(n){n.ErrorMsg==""&&(pmodel.DraftData=n.Result,pmodel.GetDraft(),top.ComFunJS.winsuccess("存草稿成功"))}))},GetDraft:function(){$.getJSON("/API/VIEWAPI.ashx?ACTION=XTGL_GETDRAFT",{P1:pmodel.FormCode,P2:pmodel.PDID},function(n){n.ErrorMsg==""&&(pmodel.DraftList=n.Result)})},SelDraft:function(n){pmodel.DraftData=n;n.JsonData&&(typeof tempmodel.SetDraftData=="function"?tempmodel.SetDraftData(JSON.parse(n.JsonData)):tempmodel.modelData=JSON.parse(n.JsonData));n.ExtData&&(pmodel.ExtData=JSON.parse(n.ExtData));setTimeout("ComFunJS.initForm()",500)},DelDraft:function(n,t){t&&t.stopPropagation();var i=0;i=n?n.ID:pmodel.DraftData.ID;$.getJSON("/API/VIEWAPI.ashx?ACTION=XTGL_DELDRAFT",{P1:i},function(){n&&pmodel.DraftList.remove(n)})},CheckData:function(){var n="";return pmodel.isPC?$(".szhl_require")&&$(".szhl_require:visible, .szhl_Int:visible, .szhl_Phone:visible").each(function(){var t=$(this).attr("title")?$(this).attr("title"):"";return $(this).hasClass("szhl_UEEDIT")&&$(this).hasClass("szhl_require")&&$(this).prop("tagName")=="DIV"&&$(this).text()==""&&$(this).find("img").length==0?n=t+$(this).parent().parent().parent().parent().find("label").text()+"不能为空":$(this).val()||!$(this).hasClass("szhl_require")||$(this).hasClass("szhl_UEEDIT")?$(this).hasClass("szhl_Int")?($(this).val()==""&&(n=t+$(this).parent().prev("label").text().replace("*","")+"不能为空"),/^[0-9]*$/.test($(this).val())||(n=t+$(this).parent().prev("label").text().replace("*","")+"必须是正整数")):$(this).hasClass("szhl_Phone")&&($(this).val()==""&&(n=t+$(this).parent().prev("label").text().replace("*","")+"不能为空"),/^0?1[3|4|7|5|8][0-9]\d{8}$/.test($(this).val())||(n=t+$(this).parent().prev("label").text().replace("*","")+"填写不正确")):n=t+$(this).parent().prev("label").text().replace("*","")+"不能为空",n!=""?!1:void 0}):$(".szhl").each(function(){var t=$(this).attr("title")?$(this).attr("title"):"",i;return $(this).hasClass("szhl_require")&&$(this).val()==""?(i="请输入",$(this).find("select").length>0&&(i="请选择"),n=i+t+$(this).parent().parent().find(".label").text()):$(this).hasClass("szhl_Int")&&!/^\+?[1-9][0-9]*$/.test($(this).val())?n=t+$(this).parent().parent().find(".label").text()+"必须是正整数":$(this).hasClass("szhl_Time")&&ComFunJS.compareTime($(this).val(),"")?n=t+$(this).parent().parent().find(".label").text()+"必须大于当前时间":$(this).hasClass("szhl_Phone")?$(this).val()&&(/^0?1[3|4|7|5|8][0-9]\d{8}$/.test($(this).val())||(n=t+$(this).parent().parent().find(".label").text()+"填写不正确")):$(this).hasClass("szhl_Float")&&$(this).val()&&(/^(?!0+(?:\.0+)?$)(?:[1-9]\d*|0)(?:\.\d{1,2})?$/.test($(this).val())||(n=t+$(this).parent().parent().find(".label").text()+"填写不正确")),n!=""?!1:void 0}),n},rebackform:function(){top.ComFunJS.winconfirm("确定要退回吗?",function(){pmodel.spReason=="同意"&&(pmodel.spReason="退回");$.post("/API/VIEWAPI.ashx?ACTION=LCSP_REBACKWF",{P1:pmodel.PIID,P2:pmodel.spReason,ID:pmodel.DataID,formcode:pmodel.FormCode},function(n){$.trim(n.ErrorMsg)==""&&(top.ComFunJS.winsuccess("退回成功"),pmodel.refiframe())})},function(){})},refiframe:function(){pmodel.isPC?(typeof top.tempindex.GetLIST=="function"?setTimeout("top.tempindex.GetLIST()",1e3):setTimeout("top.model.refpage()",1e3),setTimeout("parent.layer.closeAll()",3e3)):ComFunJS.getQueryString("mpid")?setTimeout("window.history.back();",1e3):setTimeout("window.location.replace(location.href);",1e3)},showcsdata:function(){var n=$("#csdata").html();ComFunJS.AlertMsg(n,function(){ComFunJS.closeAll()})},managetask:function(){$.post("/API/VIEWAPI.ashx?ACTION=LCSP_MANAGEWF",{P1:pmodel.PIID,P2:pmodel.spReason,ID:pmodel.DataID,formcode:pmodel.FormCode,csr:pmodel.CSUser},function(n){$.trim(n.ErrorMsg)==""&&(top.ComFunJS.winsuccess("处理成功"),pmodel.isedit=="Y"&&(tempmodel.SaveData(function(){},$(".btnSucc")[0]),pmodel.SaveExtData(pmodel.DataID)),pmodel.refiframe())})},mobsh:function(){top.ComFunJS.showComment("",function(n){alert(n)})},transferform:function(){if(pmodel.nowuser==$("#conshr1").val()){top.ComFunJS.winwarning("您不能转审给自己哦");return}if(!$("#conshr1").val()){top.ComFunJS.winwarning("请选择审核人");$("table").show();return}$.post("/API/VIEWAPI.ashx?ACTION=LCSP_MANAGEWF",{P1:pmodel.PIID,P2:pmodel.spReason,SHUser:$("#conshr1").val(),ID:pmodel.DataID,formcode:pmodel.FormCode},function(){top.ComFunJS.winsuccess("转审成功");pmodel.refiframe()})},qx:function(){parent.layer.closeAll()},jptj:function(n,t){n.ctrlKey&&(n.keyCode==13||n.keyCode==10)&&pmodel.SaveData(t.find(".btnSucc")[0],!0)},MobileWFData:[],LoadWFData:function(){var t;if(pmodel.TASKDATA.size()>0){var u=[],i={title:"",content:""},n={title:"",content:"",Date:""},f=["第一步","第二步","第三步","第四步","第五步","第六步","第七步","第八步"],r=0;$(pmodel.TASKDATA).each(function(t,e){var s="",o,h;s=pmodel.PIMODEL.IsCanceled=="Y"?e.EndTime&&e.TaskUserView?"["+e.TaskUserView+"]\r\n":"":e.EndTime&&e.TaskUserView?"["+e.TaskUserView+"]\r\n":"待处理";o=pmodel.lctype==1?e.TaskName:f[t];pmodel.isPC?(i.title=(o?o:e.TaskUserView)+(pmodel.lctype==1&&e.TaskAssInfo?"("+e.TaskAssInfo+")":""),i.content=e.userrealname+s+(e.EndTime?e.EndTime:""),r+=e.EndTime?1:0,h=$.extend({},i),u.push(h)):(n.title=(o?o:e.TaskUserView)+(pmodel.lctype==1&&e.TaskAssInfo?"("+e.TaskAssInfo+")":""),n.content=e.userrealname+s,n.Date=e.EndTime?e.EndTime:"",pmodel.MobileWFData.push($.extend({},n)))});pmodel.isPC&&($(".lcspstep").loadStep({size:"large",color:"green",steps:u}),$(".lcspstep").setStep(r),pmodel.PIMODEL.IsCanceled=="Y"&&(t=pmodel.lctype==0?$(".ystep-container-steps .ystep-step-undone").last():$(".ystep-container-steps .ystep-step-undone").eq(r-1),$(t).css("color","red"),$(t).text($(t).text()+"(退回)")))}},shzt:function(){var n="正在审批";return pmodel.PIMODEL.isComplete=="Y"?n="已审批":pmodel.PIMODEL.IsCanceled=="Y"&&(n="已退回"),n},init:function(){pmodel.FormCode.indexOf("_")>0?(pmodel.PathCode=pmodel.FormCode.split("_")[0]+"/"+pmodel.FormCode.split("_")[1],pmodel.FormCode=pmodel.FormCode.split("_")[1]):pmodel.PathCode=pmodel.FormCode+"/"+pmodel.FormCode}}),myPhotoBrowserCaptions,urlData;avalon.ready(function(){setTimeout("pmodel.init()",500)});urlData=[];
//# sourceMappingURL=WFJS.min.js.map
